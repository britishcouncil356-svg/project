<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© ØµÙŠØ§Ù†Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #0a1d37, #1e3a8a);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://www.transparenttextures.com/patterns/circuit-pattern.png') repeat;
            opacity: 0.1;
            z-index: 0;
        }
        .sidebar {
            width: 280px;
            background: rgba(44, 62, 80, 0.95);
            position: fixed;
            height: 100%;
            padding: 30px 20px;
            transition: width 0.4s ease, transform 0.4s ease;
            z-index: 100;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.3);
            right: 0;
        }
        .sidebar.closed {
            width: 0;
            transform: translateX(280px);
            padding: 0;
            overflow: hidden;
        }
        .sidebar h2 {
            text-align: center;
            color: #00c4cc;
            margin-bottom: 40px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .sidebar ul {
            list-style: none;
        }
        .sidebar ul li {
            margin: 25px 0;
        }
        .sidebar ul li a {
            color: #a3c2ff;
            text-decoration: none;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            padding: 10px 15px;
            transition: all 0.3s ease;
        }
        .sidebar ul li a:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            transform: translateX(-10px);
        }
        .sidebar ul li a i {
            margin-right: 10px;
        }
        .menu-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #3498db;
            color: #fff;
            border: none;
            padding: 12px 18px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 101;
            font-size: 1.5rem;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
            transition: background 0.3s ease;
        }
        .menu-toggle:hover {
            background: #2980b9;
        }
        .main-content {
            margin-right: 280px;
            padding: 40px;
            min-height: 100vh;
            transition: margin-right 0.4s ease;
            position: relative;
            z-index: 1;
        }
        .main-content.full {
            margin-right: 0;
        }
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            color: #00c4cc;
            font-size: 2.5rem;
            text-shadow: 0 0 10px #00c4cc;
        }
        .header .date-time {
            font-size: 1.1rem;
            color: #a3c2ff;
        }
        .section {
            display: none;
            background: rgba(30, 58, 138, 0.7);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            animation: fadeIn 0.5s ease-in-out;
        }
        .section.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .form-group {
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #00c4cc;
            font-weight: 500;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        input:focus, select:focus, textarea:focus {
            background: rgba(255, 255, 255, 0.3);
            outline: none;
            box-shadow: 0 0 10px rgba(0, 196, 204, 0.5);
        }
        textarea {
            height: 120px;
            resize: vertical;
        }
        button {
            background: #00c4cc;
            color: #fff;
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: background 0.3s ease;
        }
        button:hover {
            background: #00a1a7;
        }
        .devices-table, .users-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 10px;
            margin-top: 20px;
        }
        .devices-table th, .devices-table td, .users-table th, .users-table td {
            padding: 15px;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        .devices-table th, .users-table th {
            background: #3498db;
            color: #fff;
            text-transform: uppercase;
        }
        .devices-table td button, .users-table td button {
            padding: 8px 15px;
            margin: 0 5px;
            font-size: 0.9rem;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: rgba(30, 58, 138, 0.9);
            padding: 25px;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.8rem;
            color: #fff;
            cursor: pointer;
            transition: color 0.3s;
        }
        .close:hover {
            color: #e74c3c;
        }
        .error {
            color: #e74c3c;
            margin-top: 10px;
            display: none;
            font-size: 0.9rem;
        }
        .search-bar {
            margin-bottom: 20px;
        }
        .search-bar input {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 1rem;
        }
        .search-bar input:focus {
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 10px rgba(0, 196, 204, 0.5);
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 250px;
            }
            .sidebar.closed {
                transform: translateX(250px);
            }
            .main-content {
                margin-right: 250px;
            }
            .main-content.full {
                margin-right: 0;
            }
            .modal-content {
                width: 90%;
                max-height: 70vh;
            }
        }
        @media (max-width: 480px) {
            .menu-toggle {
                display: block;
            }
            .sidebar {
                transform: translateX(0);
            }
            .sidebar.closed {
                transform: translateX(250px);
            }
            .main-content {
                margin-right: 250px;
            }
            .main-content.full {
                margin-right: 0;
            }
            .header h1 {
                font-size: 2rem;
            }
            .modal-content {
                width: 95%;
                max-height: 65vh;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, doc, setDoc, getDoc, getDocs, updateDoc, deleteDoc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCysmZUdUYEGQ3ODBoHFgo_n6WRgcSnUhs",
            authDomain: "management-system-6afbd.firebaseapp.com",
            projectId: "management-system-6afbd",
            storageBucket: "management-system-6afbd.appspot.com",
            messagingSenderId: "593129749958",
            appId: "1:593129749958:web:886e812c9220375e5e86c7",
            measurementId: "G-G4LNGD3G4B"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
            return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
            if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
                try {
                    var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                    var firstSheetName = workbook.SheetNames[0];
                    var worksheet = workbook.Sheets[firstSheetName];
                    var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                    var filteredData = jsonData.filter(row => row.some(filledCell));
                    var headerRowIndex = filteredData.findIndex((row, index) =>
                        row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                    );
                    if (headerRowIndex === -1 || headerRowIndex > 25) {
                        headerRowIndex = 0;
                    }
                    var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
                    csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                    return csv;
                } catch (e) {
                    console.error(e);
                    return "";
                }
            }
            return gk_fileData[filename] || "";
        }

        let devices = [];
        let users = [];
        let currentUser = null;
        let shopName = localStorage.getItem('shopName') || "Ù…Ø±ÙƒØ² Ø¹Ø§Ø¯Ù„ Ù„Ù„ØµÙŠØ§Ù†Ø©";
        let shopContact = localStorage.getItem('shopContact') || "01012345678";
        let theme = localStorage.getItem('theme') || "default";
        let currentInvoiceDevice = null;

        async function initUsers() {
            const usersSnapshot = await getDocs(collection(db, 'users'));
            if (usersSnapshot.empty) {
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, 'admin@example.com', 'admin123');
                    await setDoc(doc(db, 'users', userCredential.user.uid), {
                        username: 'admin',
                        role: 'admin',
                        email: 'admin@example.com'
                    });
                } catch (error) {
                    console.error('Error creating default admin:', error);
                }
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const toggleButton = document.querySelector('.menu-toggle');
            sidebar.classList.toggle('closed');
            mainContent.classList.toggle('full');
            toggleButton.textContent = sidebar.classList.contains('closed') ? 'â˜°' : 'âœ–';
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
        }

        async function setupAddDeviceListener() {
            const addDeviceForm = document.getElementById('addDeviceForm');
            if (addDeviceForm) {
                addDeviceForm.addEventListener('submit', async e => {
                    e.preventDefault();
                    if (!currentUser) return alert('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„!');
                    const deviceName = document.getElementById('deviceName').value;
                    const customerName = document.getElementById('customerName').value;
                    const issue = document.getElementById('issue').value;
                    const contact = document.getElementById('contact').value;
                    const price = parseFloat(document.getElementById('price').value);
                    const paidAmount = parseFloat(document.getElementById('paidAmount').value);
                    const status = document.getElementById('status').value;
                    const currentDate = new Date().toLocaleString('ar-EG', { timeZone: 'Africa/Cairo' });

                    if (deviceName && customerName && issue && contact && !isNaN(price) && !isNaN(paidAmount)) {
                        if (paidAmount > price) return alert('Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø³Ø¹Ø± Ø§Ù„ØµÙŠØ§Ù†Ø©!');
                        const device = {
                            name: deviceName,
                            customer: customerName,
                            issue: issue,
                            contact: contact,
                            price: price,
                            paidAmount: paidAmount,
                            remainingAmount: price - paidAmount,
                            date: currentDate,
                            status: status,
                            createdAt: serverTimestamp()
                        };
                        try {
                            const docRef = await addDoc(collection(db, 'devices'), device);
                            device.id = docRef.id;
                            devices.push(device);
                            updateDeviceList();
                            updateStats();
                            addDeviceForm.reset();
                            showSection('devices');
                            alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ù†Ø¬Ø§Ø­!');
                        } catch (error) {
                            console.error('Error adding device:', error);
                            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ù‡Ø§Ø².');
                        }
                    } else {
                        alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!');
                    }
                });
            }
        }

        async function updateDeviceList(searchTerm = '') {
            const devicesList = document.getElementById('devicesList');
            if (devicesList) {
                devicesList.innerHTML = '';
                let filteredDevices = devices.filter(device =>
                    device.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    device.customer.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    device.contact.includes(searchTerm)
                );
                filteredDevices.forEach(device => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${device.name}</td>
                        <td>${device.customer}</td>
                        <td>${device.issue}</td>
                        <td>${device.contact}</td>
                        <td>${device.price.toFixed(2)} Ø¬Ù†ÙŠÙ‡</td>
                        <td>${device.paidAmount.toFixed(2)} Ø¬Ù†ÙŠÙ‡</td>
                        <td>${device.remainingAmount.toFixed(2)} Ø¬Ù†ÙŠÙ‡</td>
                        <td>${device.date}</td>
                        <td>${device.status}</td>
                        <td>
                            <button onclick="generateInvoice('${device.id}')">ÙØ§ØªÙˆØ±Ø©</button>
                            ${currentUser?.role === 'admin' ? `<button onclick="editDevice('${device.id}')">ØªØ¹Ø¯ÙŠÙ„</button>` : ''}
                            ${currentUser?.role === 'admin' ? `<button onclick="deleteDevice('${device.id}')">Ø­Ø°Ù</button>` : ''}
                        </td>
                    `;
                    devicesList.appendChild(row);
                });
            }
        }

        function editDevice(id) {
            if (currentUser?.role !== 'admin') return alert('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ù‡Ø§Ø²!');
            const device = devices.find(d => d.id === id);
            if (device) {
                document.getElementById('editDeviceId').value = device.id;
                document.getElementById('editDeviceName').value = device.name;
                document.getElementById('editCustomerName').value = device.customer;
                document.getElementById('editIssue').value = device.issue;
                document.getElementById('editContact').value = device.contact;
                document.getElementById('editPrice').value = device.price;
                document.getElementById('editPaidAmount').value = device.paidAmount;
                document.getElementById('editStatus').value = device.status;
                document.getElementById('editDeviceModal').style.display = 'flex';
            }
        }

        async function setupEditDeviceListener() {
            const editDeviceForm = document.getElementById('editDeviceForm');
            if (editDeviceForm) {
                editDeviceForm.addEventListener('submit', async e => {
                    e.preventDefault();
                    const id = document.getElementById('editDeviceId').value;
                    const deviceName = document.getElementById('editDeviceName').value;
                    const customerName = document.getElementById('editCustomerName').value;
                    const issue = document.getElementById('editIssue').value;
                    const contact = document.getElementById('editContact').value;
                    const price = parseFloat(document.getElementById('editPrice').value);
                    const paidAmount = parseFloat(document.getElementById('editPaidAmount').value);
                    const status = document.getElementById('editStatus').value;

                    if (deviceName && customerName && issue && contact && !isNaN(price) && !isNaN(paidAmount)) {
                        if (paidAmount > price) return alert('Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø³Ø¹Ø± Ø§Ù„ØµÙŠØ§Ù†Ø©!');
                        try {
                            await updateDoc(doc(db, 'devices', id), {
                                name: deviceName,
                                customer: customerName,
                                issue: issue,
                                contact: contact,
                                price: price,
                                paidAmount: paidAmount,
                                remainingAmount: price - paidAmount,
                                status: status,
                                updatedAt: serverTimestamp()
                            });
                            const deviceIndex = devices.findIndex(d => d.id === id);
                            if (deviceIndex !== -1) {
                                devices[deviceIndex] = { ...devices[deviceIndex], name: deviceName, customer: customerName, issue, contact, price, paidAmount, remainingAmount: price - paidAmount, status };
                            }
                            updateDeviceList();
                            updateStats();
                            closeEditDeviceModal();
                            alert('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ù†Ø¬Ø§Ø­!');
                        } catch (error) {
                            console.error('Error updating device:', error);
                            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ù‡Ø§Ø².');
                        }
                    } else {
                        alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„!');
                    }
                });
            }
        }

        function closeEditDeviceModal() {
            document.getElementById('editDeviceModal').style.display = 'none';
        }

        function setupSearchListener() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', () => updateDeviceList(searchInput.value.trim()));
            }
        }

        async function deleteDevice(id) {
            if (currentUser?.role !== 'admin') return alert('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø­Ø°Ù Ø§Ù„Ø¬Ù‡Ø§Ø²!');
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²ØŸ')) {
                try {
                    await deleteDoc(doc(db, 'devices', id));
                    devices = devices.filter(device => device.id !== id);
                    updateDeviceList();
                    updateStats();
                    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ù†Ø¬Ø§Ø­!');
                } catch (error) {
                    console.error('Error deleting device:', error);
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø¬Ù‡Ø§Ø².');
                }
            }
        }

        function generateInvoice(id) {
            const device = devices.find(d => d.id === id);
            if (device) {
                currentInvoiceDevice = device;
                const invoiceContent = `
                    <h2>ÙØ§ØªÙˆØ±Ø© ØµÙŠØ§Ù†Ø© - ${shopName}</h2>
                    <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ¬Ø±:</strong> ${shopContact}</p>
                    <p><strong>Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²:</strong> ${device.name}</p>
                    <p><strong>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${device.customer}</p>
                    <p><strong>ÙˆØµÙ Ø§Ù„Ø¹Ø·Ù„:</strong> ${device.issue}</p>
                    <p><strong>Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„:</strong> ${device.contact}</p>
                    <p><strong>Ø³Ø¹Ø± Ø§Ù„ØµÙŠØ§Ù†Ø©:</strong> ${device.price.toFixed(2)} Ø¬Ù†ÙŠÙ‡</p>
                    <p><strong>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</strong> ${device.paidAmount.toFixed(2)} Ø¬Ù†ÙŠÙ‡</p>
                    <p><strong>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</strong> ${device.remainingAmount.toFixed(2)} Ø¬Ù†ÙŠÙ‡</p>
                    <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${device.date}</p>
                    <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${device.status}</p>
                    <p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø®ØªÙŠØ§Ø±ÙƒÙ… Ø®Ø¯Ù…Ø§ØªÙ†Ø§!</p>
                `;
                document.getElementById('invoiceContent').innerHTML = invoiceContent;
                document.getElementById('invoiceModal').style.display = 'flex';
            }
        }

        async function downloadInvoicePDF() {
            if (!currentInvoiceDevice) return alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¬Ù‡Ø§Ø² Ù…Ø­Ø¯Ø¯!');
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const fontUrl = 'https://raw.githubusercontent.com/aliftype/amiri/main/fonts/amiri-regular.ttf';
            try {
                const response = await fetch(fontUrl);
                if (!response.ok) throw new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø·');
                const fontData = await response.arrayBuffer();
                const fontUint8Array = new Uint8Array(fontData);
                doc.addFileToVFS('amiri-regular.ttf', fontUint8Array);
                doc.addFont('amiri-regular.ttf', 'Amiri', 'normal');
                doc.setFont('Amiri');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø·:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø®Ø· Amiri. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
                return;
            }
            doc.setFontSize(16);

            const pageWidth = doc.internal.pageSize.width;
            const xRight = pageWidth - 10;
            const yStart = 20;

            doc.text(`ÙØ§ØªÙˆØ±Ø© ØµÙŠØ§Ù†Ø© - ${shopName}`, xRight, yStart, { align: 'right' });
            doc.text(`Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ¬Ø±: ${shopContact}`, xRight, yStart + 10, { align: 'right' });
            doc.text(`Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²: ${currentInvoiceDevice.name}`, xRight, yStart + 20, { align: 'right' });
            doc.text(`Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„: ${currentInvoiceDevice.customer}`, xRight, yStart + 30, { align: 'right' });
            doc.text(`ÙˆØµÙ Ø§Ù„Ø¹Ø·Ù„: ${currentInvoiceDevice.issue}`, xRight, yStart + 40, { align: 'right' });
            doc.text(`Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„: ${currentInvoiceDevice.contact}`, xRight, yStart + 50, { align: 'right' });
            doc.text(`Ø³Ø¹Ø± Ø§Ù„ØµÙŠØ§Ù†Ø©: ${currentInvoiceDevice.price.toFixed(2)} Ø¬Ù†ÙŠÙ‡`, xRight, yStart + 60, { align: 'right' });
            doc.text(`Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹: ${currentInvoiceDevice.paidAmount.toFixed(2)} Ø¬Ù†ÙŠÙ‡`, xRight, yStart + 70, { align: 'right' });
            doc.text(`Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${currentInvoiceDevice.remainingAmount.toFixed(2)} Ø¬Ù†ÙŠÙ‡`, xRight, yStart + 80, { align: 'right' });
            doc.text(`Ø§Ù„ØªØ§Ø±ÙŠØ®: ${currentInvoiceDevice.date}`, xRight, yStart + 90, { align: 'right' });
            doc.text(`Ø§Ù„Ø­Ø§Ù„Ø©: ${currentInvoiceDevice.status}`, xRight, yStart + 100, { align: 'right' });
            doc.text('Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø®ØªÙŠØ§Ø±ÙƒÙ… Ø®Ø¯Ù…Ø§ØªÙ†Ø§!', xRight, yStart + 110, { align: 'right' });

            doc.save(`ÙØ§ØªÙˆØ±Ø©_${currentInvoiceDevice.id}.pdf`);
        }

        function closeInvoice() {
            document.getElementById('invoiceModal').style.display = 'none';
            currentInvoiceDevice = null;
        }

        function updateStats() {
            document.getElementById('totalDevices').textContent = devices.length;
            const totalRevenue = devices.reduce((sum, device) => sum + device.paidAmount, 0);
            document.getElementById('totalRevenue').textContent = totalRevenue.toFixed(2);
            const totalRemaining = devices.reduce((sum, device) => sum + device.remainingAmount, 0);
            document.getElementById('totalRemaining').textContent = totalRemaining.toFixed(2);
            const today = new Date().toLocaleDateString('ar-EG', { timeZone: 'Africa/Cairo' });
            const dailyDevices = devices.filter(d => d.date.includes(today)).length;
            const dailyRevenue = devices.filter(d => d.date.includes(today)).reduce((sum, d) => sum + d.paidAmount, 0);
            const dailyRemaining = devices.filter(d => d.date.includes(today)).reduce((sum, d) => sum + d.remainingAmount, 0);
            document.getElementById('dailyDevices').textContent = dailyDevices;
            document.getElementById('dailyRevenue').textContent = dailyRevenue.toFixed(2);
            document.getElementById('dailyRemaining').textContent = dailyRemaining.toFixed(2);
        }

        async function exportReport() {
            if (currentUser?.role !== 'admin') return alert('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±!');
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const fontUrl = 'https://raw.githubusercontent.com/aliftype/amiri/main/fonts/amiri-regular.ttf';
            try {
                const response = await fetch(fontUrl);
                if (!response.ok) throw new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø·');
                const fontData = await response.arrayBuffer();
                const fontUint8Array = new Uint8Array(fontData);
                doc.addFileToVFS('amiri-regular.ttf', fontUint8Array);
                doc.addFont('amiri-regular.ttf', 'Amiri', 'normal');
                doc.setFont('Amiri');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø·:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø®Ø· Amiri. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
                return;
            }
            doc.setFontSize(16);

            const pageWidth = doc.internal.pageSize.width;
            const xRight = pageWidth - 10;
            const yStart = 20;

            doc.text(`ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ - ${shopName}`, xRight, 20, { align: 'right' });
            doc.setFontSize(12);
            doc.text(`Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleString('ar-EG', { timeZone: 'Africa/Cairo' })}`, xRight, 30, { align: 'right' });
            doc.text(`Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©: ${document.getElementById('dailyDevices').textContent}`, xRight, 40, { align: 'right' });
            doc.text(`Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª: ${document.getElementById('dailyRevenue').textContent} Ø¬Ù†ÙŠÙ‡`, xRight, 50, { align: 'right' });
            doc.text(`Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${document.getElementById('dailyRemaining').textContent} Ø¬Ù†ÙŠÙ‡`, xRight, 60, { align: 'right' });

            const today = new Date().toLocaleDateString('ar-EG', { timeZone: 'Africa/Cairo' });
            const dailyDevices = devices.filter(d => d.date.includes(today)).map(d => [
                d.name,
                d.customer,
                d.issue,
                d.contact,
                `${d.price.toFixed(2)} Ø¬Ù†ÙŠÙ‡`,
                `${d.paidAmount.toFixed(2)} Ø¬Ù†ÙŠÙ‡`,
                `${d.remainingAmount.toFixed(2)} Ø¬Ù†ÙŠÙ‡`,
                d.date,
                d.status
            ]);

            const head = [['Ø§Ù„Ø¬Ù‡Ø§Ø²', 'Ø§Ù„Ø¹Ù…ÙŠÙ„', 'Ø§Ù„Ø¹Ø·Ù„', 'Ø§Ù„ØªÙˆØ§ØµÙ„', 'Ø³Ø¹Ø± Ø§Ù„ØµÙŠØ§Ù†Ø©', 'Ø§Ù„Ù…Ø¯ÙÙˆØ¹', 'Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„Ø­Ø§Ù„Ø©']];
            const body = dailyDevices;

            doc.autoTable({
                head: head,
                body: body,
                startY: 70,
                styles: { font: 'Amiri', halign: 'right', fontSize: 10, cellPadding: 2 },
                headStyles: { fillColor: [52, 152, 219], halign: 'center' },
                margin: { right: 10, left: 10 }
            });

            doc.save(`ØªÙ‚Ø±ÙŠØ±_ÙŠÙˆÙ…ÙŠ_${today}.pdf`);
        }

        async function setupSettingsListener() {
            const settingsForm = document.getElementById('settingsForm');
            if (settingsForm) {
                settingsForm.addEventListener('submit', async e => {
                    e.preventDefault();
                    if (currentUser?.role !== 'admin') return alert('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª!');
                    const shopNameInput = document.getElementById('shopName').value;
                    const shopContactInput = document.getElementById('shopContact').value;
                    const themeInput = document.getElementById('theme').value;

                    if (shopNameInput && shopContactInput && themeInput) {
                        shopName = shopNameInput;
                        shopContact = shopContactInput;
                        theme = themeInput;
                        try {
                            await setDoc(doc(db, 'settings', 'shop'), { shopName, shopContact, theme }, { merge: true });
                            localStorage.setItem('shopName', shopName);
                            localStorage.setItem('shopContact', shopContact);
                            localStorage.setItem('theme', theme);
                            applyTheme();
                            alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
                        } catch (error) {
                            console.error('Error saving settings:', error);
                            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.');
                        }
                    } else {
                        alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„!');
                    }
                });
            }
        }

        function applyTheme() {
            if (theme === 'dark') {
                document.body.style.background = 'linear-gradient(135deg, #1a2a44, #2e4a7e)';
            } else if (theme === 'light') {
                document.body.style.background = 'linear-gradient(135deg, #e0e7ff, #c7d2fe)';
                document.querySelectorAll('input, select, textarea').forEach(el => el.style.color = '#333');
            } else {
                document.body.style.background = 'linear-gradient(135deg, #0a1d37, #1e3a8a)';
                document.querySelectorAll('input, select, textarea').forEach(el => el.style.color = '#fff');
            }
        }

        function updateDateTime() {
            const now = new Date().toLocaleString('ar-EG', { timeZone: 'Africa/Cairo', weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', timeZoneName: 'short' });
            document.getElementById('dateTime').textContent = `Ø§Ù„ÙŠÙˆÙ…: ${now}`;
        }

        function restrictAccess(role) {
            if (role !== 'admin') {
                document.querySelector('a[onclick="showSection(\'add-device\')"]').parentElement.style.display = 'none';
                document.querySelector('a[onclick="showSection(\'reports\')"]').parentElement.style.display = 'none';
                document.querySelector('a[onclick="showSection(\'settings\')"]').parentElement.style.display = 'none';
                document.getElementById('add-device').style.display = 'none';
                document.getElementById('reports').style.display = 'none';
                document.getElementById('settings').style.display = 'none';
            }
        }

        function logout() {
            signOut(auth).then(() => {
                currentUser = null;
                devices = [];
                users = [];
                const loginModal = document.getElementById('loginModal');
                const sidebar = document.getElementById('sidebar');
                const menuToggle = document.querySelector('.menu-toggle');
                if (loginModal) loginModal.style.display = 'flex';
                if (sidebar) sidebar.classList.add('closed');
                if (menuToggle) menuToggle.style.display = 'none';
                document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
                const loginForm = document.getElementById('loginForm');
                if (loginForm) loginForm.reset();
                const devicesList = document.getElementById('devicesList');
                if (devicesList) devicesList.innerHTML = '';
                const usersList = document.getElementById('usersList');
                if (usersList) usersList.innerHTML = '';
                closeEditDeviceModal();
                closeInvoice();
            }).catch(error => {
                console.error('Error signing out:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬.');
            });
        }

        async function setupAddUserListener() {
            const addUserForm = document.getElementById('addUserForm');
            if (addUserForm) {
                addUserForm.addEventListener('submit', async e => {
                    e.preventDefault();
                    if (currentUser?.role !== 'admin') return alert('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…!');
                    const username = document.getElementById('newUsername').value.trim();
                    const password = document.getElementById('newPassword').value;
                    const role = document.getElementById('newRole').value;
                    if (username && password && role) {
                        try {
                            const userCredential = await createUserWithEmailAndPassword(auth, `${username}@example.com`, password);
                            await setDoc(doc(db, 'users', userCredential.user.uid), {
                                username,
                                role,
                                email: `${username}@example.com`
                            });
                            users.push({ uid: userCredential.user.uid, username, role });
                            updateUsersList();
                            addUserForm.reset();
                            alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­!');
                        } catch (error) {
                            console.error('Error adding user:', error);
                            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….');
                        }
                    } else {
                        alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„!');
                    }
                });
            }
        }

        async function updateUsersList() {
            const usersList = document.getElementById('usersList');
            if (usersList) {
                usersList.innerHTML = '';
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.username}</td>
                        <td>${user.role === 'admin' ? 'Ø£Ø¯Ù…Ù†' : 'Ù…Ø³ØªØ®Ø¯Ù…'}</td>
                        <td><button onclick="deleteUser('${user.uid}')">Ø­Ø°Ù</button></td>
                    `;
                    usersList.appendChild(row);
                });
            }
        }

        function deleteUser(uid) {
            if (uid === auth.currentUser?.uid) return alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ!');
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) {
                try {
                    deleteDoc(doc(db, 'users', uid));
                    users = users.filter(u => u.uid !== uid);
                    updateUsersList();
                    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­!');
                } catch (error) {
                    console.error('Error deleting user:', error);
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….');
                }
            }
        }

        async function setupLoginListener() {
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', async e => {
                    e.preventDefault();
                    const username = document.getElementById('username').value.trim();
                    const password = document.getElementById('password').value;
                    const errorMessage = document.getElementById('errorMessage');
                    if (username && password) {
                        try {
                            const userCredential = await signInWithEmailAndPassword(auth, `${username}@example.com`, password);
                            const userDoc = await getDoc(doc(db, 'users', userCredential.user.uid));
                            if (userDoc.exists()) {
                                currentUser = { uid: userCredential.user.uid, ...userDoc.data() };
                                const loginModal = document.getElementById('loginModal');
                                const sidebar = document.getElementById('sidebar');
                                const menuToggle = document.querySelector('.menu-toggle');
                                if (loginModal) loginModal.style.display = 'none';
                                if (sidebar) sidebar.style.display = 'block';
                                if (menuToggle) menuToggle.style.display = 'block';
                                restrictAccess(currentUser.role);
                                await fetchData();
                                updateStats();
                                showSection('dashboard');
                                if (errorMessage) errorMessage.style.display = 'none';
                            } else {
                                if (errorMessage) errorMessage.style.display = 'block';
                            }
                        } catch (error) {
                            console.error('Error logging in:', error);
                            if (errorMessage) errorMessage.style.display = 'block';
                        }
                    } else {
                        if (errorMessage) errorMessage.style.display = 'block';
                    }
                });
            }
        }

        async function fetchData() {
            try {
                const q = query(collection(db, 'devices'), orderBy('createdAt', 'desc'));
                const devicesSnapshot = await getDocs(q);
                devices = devicesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                if (currentUser?.role === 'admin') {
                    const usersSnapshot = await getDocs(collection(db, 'users'));
                    users = usersSnapshot.docs.map(doc => ({ uid: doc.id, ...doc.data() }));
                }

                const settingsDoc = await getDoc(doc(db, 'settings', 'shop'));
                if (settingsDoc.exists()) {
                    const settings = settingsDoc.data();
                    shopName = settings.shopName || shopName;
                    shopContact = settings.shopContact || shopContact;
                    theme = settings.theme || theme;
                    const shopNameInput = document.getElementById('shopName');
                    const shopContactInput = document.getElementById('shopContact');
                    const themeInput = document.getElementById('theme');
                    if (shopNameInput) shopNameInput.value = shopName;
                    if (shopContactInput) shopContactInput.value = shopContact;
                    if (themeInput) themeInput.value = theme;
                }
                applyTheme();
            } catch (error) {
                console.error('Error fetching data:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
            }
        }

        window.addEventListener('load', async () => {
            await initUsers();
            updateDateTime();
            setInterval(updateDateTime, 60000);
            applyTheme();
            setupAddDeviceListener();
            setupEditDeviceListener();
            setupSearchListener();
            setupSettingsListener();
            setupAddUserListener();
            setupLoginListener();

            onAuthStateChanged(auth, async user => {
                document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
                const loginModal = document.getElementById('loginModal');
                const sidebar = document.getElementById('sidebar');
                const menuToggle = document.querySelector('.menu-toggle');
                if (user) {
                    const userDoc = await getDoc(doc(db, 'users', user.uid));
                    if (userDoc.exists()) {
                        currentUser = { uid: user.uid, ...userDoc.data() };
                        if (loginModal) loginModal.style.display = 'none';
                        if (sidebar) sidebar.style.display = 'block';
                        if (menuToggle) menuToggle.style.display = 'block';
                        restrictAccess(currentUser.role);
                        await fetchData();
                        updateStats();
                        showSection('dashboard');
                    } else {
                        signOut(auth);
                    }
                } else {
                    if (loginModal) loginModal.style.display = 'flex';
                    if (sidebar) sidebar.style.display = 'none';
                    if (menuToggle) menuToggle.style.display = 'none';
                }
            });
        });

        window.toggleSidebar = toggleSidebar;
        window.showSection = showSection;
        window.editDevice = editDevice;
        window.closeEditDeviceModal = closeEditDeviceModal;
        window.deleteDevice = deleteDevice;
        window.generateInvoice = generateInvoice;
        window.downloadInvoicePDF = downloadInvoicePDF;
        window.closeInvoice = closeInvoice;
        window.exportReport = exportReport;
        window.logout = logout;
        window.deleteUser = deleteUser;
    </script>
</head>
<body>
    <button class="menu-toggle" onclick="toggleSidebar()">âœ–</button>
    <div class="sidebar" id="sidebar">
        <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
        <ul>
            <li><a href="#" onclick="showSection('dashboard');"><i>ğŸ </i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
            <li><a href="#" onclick="showSection('add-device');"><i>â•</i> Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø²</a></li>
            <li><a href="#" onclick="showSection('devices');"><i>ğŸ“‹</i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</a></li>
            <li><a href="#" onclick="showSection('reports');"><i>ğŸ“Š</i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a></li>
            <li><a href="#" onclick="showSection('settings');"><i>âš™ï¸</i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a></li>
            <li><a href="#" onclick="logout()"><i>ğŸšª</i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a></li>
        </ul>
    </div>

    <div class="main-content" id="mainContent">
        <div class="header">
            <h1>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© ØµÙŠØ§Ù†Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</h1>
            <div class="date-time" id="dateTime"></div>
        </div>

        <div id="dashboard" class="section active">
            <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
            <p>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© ØµÙŠØ§Ù†Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ. Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù…Ù„Ùƒ Ø¨ÙƒÙØ§Ø¡Ø©.</p>
            <div class="stats">
                <div class="stat-card">Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø³Ø¬Ù„Ø©: <span id="totalDevices">0</span></div>
                <div class="stat-card">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©: <span id="totalRevenue">0</span> Ø¬Ù†ÙŠÙ‡</div>
                <div class="stat-card">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="totalRemaining">0</span> Ø¬Ù†ÙŠÙ‡</div>
            </div>
        </div>

        <div id="add-device" class="section">
            <h2>Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯</h2>
            <form id="addDeviceForm">
                <div class="form-group">
                    <label for="deviceName">Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²:</label>
                    <input type="text" id="deviceName" name="deviceName" required>
                </div>
                <div class="form-group">
                    <label for="customerName">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
                    <input type="text" id="customerName" name="customerName" required>
                </div>
                <div class="form-group">
                    <label for="issue">ÙˆØµÙ Ø§Ù„Ø¹Ø·Ù„:</label>
                    <textarea id="issue" name="issue" required></textarea>
                </div>
                <div class="form-group">
                    <label for="contact">Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„:</label>
                    <input type="tel" id="contact" name="contact" required placeholder="Ù…Ø«Ø§Ù„: 01012345678">
                </div>
                <div class="form-group">
                    <label for="price">Ø³Ø¹Ø± Ø§Ù„ØµÙŠØ§Ù†Ø© (Ø¬Ù†ÙŠÙ‡):</label>
                    <input type="number" id="price" name="price" required step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label for="paidAmount">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ (Ø¬Ù†ÙŠÙ‡):</label>
                    <input type="number" id="paidAmount" name="paidAmount" required step="0.01" min="0" value="0">
                </div>
                <div class="form-group">
                    <label for="status">Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù‡Ø§Ø²:</label>
                    <select id="status" name="status" required>
                        <option value="ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                        <option value="ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©">ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©</option>
                        <option value="Ù…ÙƒØªÙ…Ù„">Ù…ÙƒØªÙ…Ù„</option>
                    </select>
                </div>
                <button type="submit">Ø­ÙØ¸ Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
            </form>
        </div>

        <div id="devices" class="section">
            <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</h2>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¬Ù‡Ø§Ø² (Ø§Ø³Ù…ØŒ Ø¹Ù…ÙŠÙ„ØŒ Ø±Ù‚Ù… ØªÙˆØ§ØµÙ„)">
            </div>
            <table class="devices-table">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
                        <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                        <th>Ø§Ù„Ø¹Ø·Ù„</th>
                        <th>Ø§Ù„ØªÙˆØ§ØµÙ„</th>
                        <th>Ø³Ø¹Ø± Ø§Ù„ØµÙŠØ§Ù†Ø©</th>
                        <th>Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>
                        <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="devicesList"></tbody>
            </table>
        </div>

        <div id="reports" class="section">
            <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h2>
            <div class="report-card">
                <h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©: <span id="dailyDevices">0</span></p>
                <p>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª: <span id="dailyRevenue">0</span> Ø¬Ù†ÙŠÙ‡</p>
                <p>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="dailyRemaining">0</span> Ø¬Ù†ÙŠÙ‡</p>
            </div>
            <button onclick="exportReport()">ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± PDF</button>
        </div>

        <div id="settings" class="section">
            <h2>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
            <form id="settingsForm">
                <div class="form-group">
                    <label for="shopName">Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±:</label>
                    <input type="text" id="shopName" name="shopName" value="Ù…Ø±ÙƒØ² Ø¹Ø§Ø¯Ù„ Ù„Ù„ØµÙŠØ§Ù†Ø©">
                </div>
                <div class="form-group">
                    <label for="shopContact">Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ¬Ø±:</label>
                    <input type="tel" id="shopContact" name="shopContact" value="01012345678">
                </div>
                <div class="form-group">
                    <label for="theme">Ø§Ù„Ø«ÙŠÙ…:</label>
                    <select id="theme" name="theme">
                        <option value="default">Ø§ÙØªØ±Ø§Ø¶ÙŠ</option>
                        <option value="dark">Ø¯Ø§ÙƒÙ†</option>
                        <option value="light">ÙØ§ØªØ­</option>
                    </select>
                </div>
                <button type="submit">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            </form>
            <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
            <form id="addUserForm">
                <div class="form-group">
                    <label for="newUsername">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:</label>
                    <input type="text" id="newUsername" required>
                </div>
                <div class="form-group">
                    <label for="newPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
                    <input type="password" id="newPassword" required>
                </div>
                <div class="form-group">
                    <label for="newRole">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©:</label>
                    <select id="newRole" required>
                        <option value="admin">Ø£Ø¯Ù…Ù†</option>
                        <option value="user">Ù…Ø³ØªØ®Ø¯Ù…</option>
                    </select>
                </div>
                <button type="submit">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</button>
            </form>
            <table class="users-table">
                <thead>
                    <tr>
                        <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                        <th>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</th>
                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="usersList"></tbody>
            </table>
        </div>
    </div>

    <div id="invoiceModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeInvoice()">&times;</span>
            <div id="invoiceContent"></div>
            <button onclick="downloadInvoicePDF()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒÙ€ PDF</button>
        </div>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
                    <input type="text" id="username" name="username" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                </div>
                <div class="form-group">
                    <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
                    <input type="password" id="password" name="password" required placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                </div>
                <button type="submit">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                <p id="errorMessage" class="error">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!</p>
            </form>
        </div>
    </div>

    <div id="editDeviceModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditDeviceModal()">&times;</span>
            <h2>ØªØ¹Ø¯ÙŠÙ„ Ø¬Ù‡Ø§Ø²</h2>
            <form id="editDeviceForm">
                <div class="form-group">
                    <label for="editDeviceId">Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù‡Ø§Ø²:</label>
                    <input type="text" id="editDeviceId" name="editDeviceId" readonly>
                </div>
                <div class="form-group">
                    <label for="editDeviceName">Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²:</label>
                    <input type="text" id="editDeviceName" name="editDeviceName" required>
                </div>
                <div class="form-group">
                    <label for="editCustomerName">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
                    <input type="text" id="editCustomerName" name="editCustomerName" required>
                </div>
                <div class="form-group">
                    <label for="editIssue">ÙˆØµÙ Ø§Ù„Ø¹Ø·Ù„:</label>
                    <textarea id="editIssue" name="editIssue" required></textarea>
                </div>
                <div class="form-group">
                    <label for="editContact">Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„:</label>
                    <input type="tel" id="editContact" name="editContact" required placeholder="Ù…Ø«Ø§Ù„: 01012345678">
                </div>
                <div class="form-group">
                    <label for="editPrice">Ø³Ø¹Ø± Ø§Ù„ØµÙŠØ§Ù†Ø© (Ø¬Ù†ÙŠÙ‡):</label>
                    <input type="number" id="editPrice" name="editPrice" required step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label for="editPaidAmount">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ (Ø¬Ù†ÙŠÙ‡):</label>
                    <input type="number" id="editPaidAmount" name="editPaidAmount" required step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label for="editStatus">Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù‡Ø§Ø²:</label>
                    <select id="editStatus" name="editStatus" required>
                        <option value="ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                        <option value="ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©">ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©</option>
                        <option value="Ù…ÙƒØªÙ…Ù„">Ù…ÙƒØªÙ…Ù„</option>
                    </select>
                </div>
                <button type="submit">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
            </form>
        </div>
    </div>
</body>
</html>
